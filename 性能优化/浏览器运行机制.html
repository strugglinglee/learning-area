<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器运行机制 | 阿李贝斯的学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="偶尔学习，经常摸鱼">
    
    <link rel="preload" href="/learning-area/assets/css/0.styles.d66e2873.css" as="style"><link rel="preload" href="/learning-area/assets/js/app.8c1e866d.js" as="script"><link rel="preload" href="/learning-area/assets/js/2.5f901e15.js" as="script"><link rel="preload" href="/learning-area/assets/js/97.286918aa.js" as="script"><link rel="prefetch" href="/learning-area/assets/js/10.e61ffacd.js"><link rel="prefetch" href="/learning-area/assets/js/11.7e68eae8.js"><link rel="prefetch" href="/learning-area/assets/js/12.1bdc8ad7.js"><link rel="prefetch" href="/learning-area/assets/js/13.acc13414.js"><link rel="prefetch" href="/learning-area/assets/js/14.53b8e1ee.js"><link rel="prefetch" href="/learning-area/assets/js/15.db6b49cf.js"><link rel="prefetch" href="/learning-area/assets/js/16.07948b92.js"><link rel="prefetch" href="/learning-area/assets/js/17.e804cadc.js"><link rel="prefetch" href="/learning-area/assets/js/18.6e01d38f.js"><link rel="prefetch" href="/learning-area/assets/js/19.4f06270b.js"><link rel="prefetch" href="/learning-area/assets/js/20.492e8f35.js"><link rel="prefetch" href="/learning-area/assets/js/21.f92c0b9a.js"><link rel="prefetch" href="/learning-area/assets/js/22.522a1dcd.js"><link rel="prefetch" href="/learning-area/assets/js/23.2253fbff.js"><link rel="prefetch" href="/learning-area/assets/js/24.0dfe8d5b.js"><link rel="prefetch" href="/learning-area/assets/js/25.75fc21ae.js"><link rel="prefetch" href="/learning-area/assets/js/26.786002bd.js"><link rel="prefetch" href="/learning-area/assets/js/27.478c9e8a.js"><link rel="prefetch" href="/learning-area/assets/js/28.de46f730.js"><link rel="prefetch" href="/learning-area/assets/js/29.2dd315de.js"><link rel="prefetch" href="/learning-area/assets/js/3.90c41175.js"><link rel="prefetch" href="/learning-area/assets/js/30.a906febe.js"><link rel="prefetch" href="/learning-area/assets/js/31.273d5071.js"><link rel="prefetch" href="/learning-area/assets/js/32.3ffca364.js"><link rel="prefetch" href="/learning-area/assets/js/33.46ed602b.js"><link rel="prefetch" href="/learning-area/assets/js/34.263ab9c2.js"><link rel="prefetch" href="/learning-area/assets/js/35.a70c1c52.js"><link rel="prefetch" href="/learning-area/assets/js/36.7ec1efcf.js"><link rel="prefetch" href="/learning-area/assets/js/37.483df6f3.js"><link rel="prefetch" href="/learning-area/assets/js/38.c9ad9a3c.js"><link rel="prefetch" href="/learning-area/assets/js/39.1c6a0a77.js"><link rel="prefetch" href="/learning-area/assets/js/4.437481c8.js"><link rel="prefetch" href="/learning-area/assets/js/40.8478112c.js"><link rel="prefetch" href="/learning-area/assets/js/41.8a51bd51.js"><link rel="prefetch" href="/learning-area/assets/js/42.28628385.js"><link rel="prefetch" href="/learning-area/assets/js/43.79d17c3c.js"><link rel="prefetch" href="/learning-area/assets/js/44.4e17f017.js"><link rel="prefetch" href="/learning-area/assets/js/45.17b329c8.js"><link rel="prefetch" href="/learning-area/assets/js/46.47e275cf.js"><link rel="prefetch" href="/learning-area/assets/js/47.1bbdc0ae.js"><link rel="prefetch" href="/learning-area/assets/js/48.ef00515a.js"><link rel="prefetch" href="/learning-area/assets/js/49.357396ed.js"><link rel="prefetch" href="/learning-area/assets/js/5.2f614f52.js"><link rel="prefetch" href="/learning-area/assets/js/50.974d2a4f.js"><link rel="prefetch" href="/learning-area/assets/js/51.8767a648.js"><link rel="prefetch" href="/learning-area/assets/js/52.efd6d1c9.js"><link rel="prefetch" href="/learning-area/assets/js/53.10f7d84f.js"><link rel="prefetch" href="/learning-area/assets/js/54.397a41f8.js"><link rel="prefetch" href="/learning-area/assets/js/55.4ee17a89.js"><link rel="prefetch" href="/learning-area/assets/js/56.949b6e18.js"><link rel="prefetch" href="/learning-area/assets/js/57.e7f12a84.js"><link rel="prefetch" href="/learning-area/assets/js/58.c41542b9.js"><link rel="prefetch" href="/learning-area/assets/js/59.6aed5b5c.js"><link rel="prefetch" href="/learning-area/assets/js/6.4704f9e4.js"><link rel="prefetch" href="/learning-area/assets/js/60.6411d19b.js"><link rel="prefetch" href="/learning-area/assets/js/61.0cb87b64.js"><link rel="prefetch" href="/learning-area/assets/js/62.08e6c468.js"><link rel="prefetch" href="/learning-area/assets/js/63.18c7f63d.js"><link rel="prefetch" href="/learning-area/assets/js/64.81cd1c11.js"><link rel="prefetch" href="/learning-area/assets/js/65.9bc0d5d3.js"><link rel="prefetch" href="/learning-area/assets/js/66.de79083c.js"><link rel="prefetch" href="/learning-area/assets/js/67.95d068a2.js"><link rel="prefetch" href="/learning-area/assets/js/68.ad4a6d4f.js"><link rel="prefetch" href="/learning-area/assets/js/69.50fbdd23.js"><link rel="prefetch" href="/learning-area/assets/js/7.69bbd2a0.js"><link rel="prefetch" href="/learning-area/assets/js/70.f4114c68.js"><link rel="prefetch" href="/learning-area/assets/js/71.c3d80cc4.js"><link rel="prefetch" href="/learning-area/assets/js/72.b6de188b.js"><link rel="prefetch" href="/learning-area/assets/js/73.9e4d4a3b.js"><link rel="prefetch" href="/learning-area/assets/js/74.cc00edd9.js"><link rel="prefetch" href="/learning-area/assets/js/75.cc848628.js"><link rel="prefetch" href="/learning-area/assets/js/76.d0e3cab6.js"><link rel="prefetch" href="/learning-area/assets/js/77.e95f0343.js"><link rel="prefetch" href="/learning-area/assets/js/78.bca613f1.js"><link rel="prefetch" href="/learning-area/assets/js/79.0547b924.js"><link rel="prefetch" href="/learning-area/assets/js/8.ed3959dc.js"><link rel="prefetch" href="/learning-area/assets/js/80.ca138246.js"><link rel="prefetch" href="/learning-area/assets/js/81.11cdf192.js"><link rel="prefetch" href="/learning-area/assets/js/82.80f2369e.js"><link rel="prefetch" href="/learning-area/assets/js/83.7d8e31c2.js"><link rel="prefetch" href="/learning-area/assets/js/84.84524732.js"><link rel="prefetch" href="/learning-area/assets/js/85.45c7c596.js"><link rel="prefetch" href="/learning-area/assets/js/86.b98e7d1d.js"><link rel="prefetch" href="/learning-area/assets/js/87.08bdcc59.js"><link rel="prefetch" href="/learning-area/assets/js/88.5a1bf64e.js"><link rel="prefetch" href="/learning-area/assets/js/89.cc8b7968.js"><link rel="prefetch" href="/learning-area/assets/js/9.081bce7b.js"><link rel="prefetch" href="/learning-area/assets/js/90.a6fb5827.js"><link rel="prefetch" href="/learning-area/assets/js/91.23b00679.js"><link rel="prefetch" href="/learning-area/assets/js/92.89f9585d.js"><link rel="prefetch" href="/learning-area/assets/js/93.d54b4f5d.js"><link rel="prefetch" href="/learning-area/assets/js/94.f627972e.js"><link rel="prefetch" href="/learning-area/assets/js/95.448c2253.js"><link rel="prefetch" href="/learning-area/assets/js/96.e3336985.js">
    <link rel="stylesheet" href="/learning-area/assets/css/0.styles.d66e2873.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learning-area/" class="home-link router-link-active"><!----> <span class="site-name">阿李贝斯的学习文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learning-area/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/strugglinglee/learning-area" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learning-area/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/strugglinglee/learning-area" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/css" class="sidebar-heading clickable"><span>CSS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/javascript" class="sidebar-heading clickable"><span>JS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/vue" class="sidebar-heading clickable"><span>VUE</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/git" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/前端工程化" class="sidebar-heading clickable"><span>前端工程化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/图形学" class="sidebar-heading clickable"><span>图形学</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/业务相关" class="sidebar-heading clickable"><span>业务相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>性能优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning-area/性能优化/浏览器运行机制.html" class="active sidebar-link">浏览器运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning-area/性能优化/浏览器运行机制.html#浏览器内核" class="sidebar-link">浏览器内核</a></li><li class="sidebar-sub-header"><a href="/learning-area/性能优化/浏览器运行机制.html#渲染过程" class="sidebar-link">渲染过程</a></li><li class="sidebar-sub-header"><a href="/learning-area/性能优化/浏览器运行机制.html#渲染优化" class="sidebar-link">渲染优化</a></li><li class="sidebar-sub-header"><a href="/learning-area/性能优化/浏览器运行机制.html#阻塞" class="sidebar-link">阻塞</a></li></ul></li><li><a href="/learning-area/性能优化/cdn.html" class="sidebar-link">cdn</a></li><li><a href="/learning-area/性能优化/DOM优化.html" class="sidebar-link">DOM优化</a></li><li><a href="/learning-area/性能优化/ssr.html" class="sidebar-link">ssr</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/docker" class="sidebar-heading clickable"><span>Docker</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/node" class="sidebar-heading clickable"><span>Node.js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/vite" class="sidebar-heading clickable"><span>Vite</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learning-area/others" class="sidebar-heading clickable"><span>其他</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器运行机制"><a href="#浏览器运行机制" class="header-anchor">#</a> 浏览器运行机制</h1> <h2 id="浏览器内核"><a href="#浏览器内核" class="header-anchor">#</a> 浏览器内核</h2> <h3 id="组成"><a href="#组成" class="header-anchor">#</a> 组成</h3> <ul><li>渲染引擎
<ul><li>HTML 解释器</li> <li>CSS 解释器</li> <li>布局</li> <li>网络</li> <li>存储</li> <li>图形</li> <li>音视频</li> <li>图片解码器等</li></ul></li> <li>JS引擎</li></ul> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <ul><li>Trident（IE）</li> <li>Gecko（火狐）</li> <li><strong>Blink（Chrome、Opera）</strong></li> <li><strong>Webkit（Safari）</strong></li></ul> <p>Blink是基于Webkit衍生而来的一个分支</p> <h2 id="渲染过程"><a href="#渲染过程" class="header-anchor">#</a> 渲染过程</h2> <h3 id="渲染部件"><a href="#渲染部件" class="header-anchor">#</a> 渲染部件</h3> <ol><li><p><strong>HTML 解释器</strong>：将 HTML 文档经过词法分析输出 DOM 树</p></li> <li><p><strong>CSS 解释器</strong>：解析 CSS 文档, 生成样式规则</p></li> <li><p><strong>图层布局计算模块</strong>：布局计算每个对象的精确位置和大小</p></li> <li><p><strong>视图绘制模块与JavaScript 引擎</strong>：进行具体节点的图像绘制，将像素渲染到屏幕上</p></li> <li><p><strong>JavaScript 引擎</strong>：编译执行 Javascript 代码</p></li></ol> <h3 id="渲染步骤"><a href="#渲染步骤" class="header-anchor">#</a> 渲染步骤</h3> <ol><li>基于 HTML 构建一个 DOM 树</li> <li>这棵 DOM 树与 CSS 解释器解析出的 CSSOM 相结合，就有了布局渲染树</li> <li>最后浏览器以布局渲染树为蓝本，去计算布局并绘制图像，完成页面的初次渲染</li></ol> <h4 id="解析-html"><a href="#解析-html" class="header-anchor">#</a> 解析 HTML</h4> <p>在这一步浏览器执行了所有的加载解析逻辑，在解析 HTML 的过程中发出了页面渲染所需的各种外部资源请求。</p> <h4 id="计算样式"><a href="#计算样式" class="header-anchor">#</a> 计算样式</h4> <p>浏览器将识别并加载所有的 CSS 样式信息与 DOM 树合并，最终生成页面 render 树（:after :before 这样的伪元素会在这个环节被构建到 DOM 树中）。</p> <h4 id="计算图层布局"><a href="#计算图层布局" class="header-anchor">#</a> 计算图层布局</h4> <p>页面中所有元素的相对位置信息，大小等信息均在这一步得到计算。</p> <h4 id="绘制图层"><a href="#绘制图层" class="header-anchor">#</a> 绘制图层</h4> <p>在这一步中浏览器会根据我们的 DOM 代码结果，把每一个页面图层转换为像素，并对所有的媒体文件进行解码。</p> <h4 id="整合图层-得到页面"><a href="#整合图层-得到页面" class="header-anchor">#</a> 整合图层，得到页面</h4> <p>最后一步浏览器会合并合各个图层，将数据由 CPU 输出给 GPU 最终绘制在屏幕上。（复杂的视图层会给这个阶段的 GPU 计算带来一些压力，在实际应用中为了优化动画性能，我们有时会手动区分不同的图层）。</p> <h2 id="渲染优化"><a href="#渲染优化" class="header-anchor">#</a> 渲染优化</h2> <p><strong>CSS引擎查找样式表规则：</strong>
CSS选择符是从右往左进行匹配的</p> <h3 id="css书写建议"><a href="#css书写建议" class="header-anchor">#</a> css书写建议</h3> <ol><li>避免使用通配符，只对需要用到的元素进行选择</li> <li>关注可以通过继承实现的属性，避免重复匹配重复定义</li> <li>少用标签选择器。如果可以，用类选择器替代</li> <li>减少嵌套。后代选择器的开销是最高的，因此我们应该尽量将选择器的深度降到最低（最高不要超过三层），尽可能使用类来关联每一个标签元素</li></ol> <h2 id="阻塞"><a href="#阻塞" class="header-anchor">#</a> 阻塞</h2> <p>HTML、CSS 和 JS，都具有阻塞渲染的特性。</p> <h3 id="尽快将css下载到客户端"><a href="#尽快将css下载到客户端" class="header-anchor">#</a> 尽快将CSS下载到客户端</h3> <p>尽早（将 CSS 放在 head 标签里）和尽快（启用 CDN 实现静态资源加载速度的优化）。</p> <h3 id="js-引擎"><a href="#js-引擎" class="header-anchor">#</a> JS 引擎</h3> <p>JS 的作用在于修改，它帮助我们修改网页的方方面面：内容、样式以及它如何响应用户交互。这“方方面面”的修改，本质上都是对 DOM 和 CSSDOM 进行修改。因此 JS 的执行会阻止 CSSOM，在我们不作显式声明的情况下，它也会阻塞 DOM。</p> <h4 id="js-引擎是独立于渲染引擎存在的"><a href="#js-引擎是独立于渲染引擎存在的" class="header-anchor">#</a> JS 引擎是独立于渲染引擎存在的</h4> <p>我们的 JS 代码在文档的何处插入，就在何处执行。当 HTML 解析器遇到一个 script 标签时，它会暂停渲染过程，将控制权交给 JS 引擎。JS 引擎对内联的 JS 代码会直接执行，对外部 JS 文件还要先获取到脚本、再进行执行。</p> <p>等 JS 引擎运行完毕，浏览器又会把控制权还给渲染引擎，继续 CSSOM 和 DOM 的构建。</p> <h4 id="js-的三种加载方式"><a href="#js-的三种加载方式" class="header-anchor">#</a> JS 的三种加载方式</h4> <h5 id="正常模式"><a href="#正常模式" class="header-anchor">#</a> 正常模式</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h5 id="async-模式"><a href="#async-模式" class="header-anchor">#</a> async 模式</h5> <p>async 模式下，JS 不会阻塞浏览器做任何其它的事情。它的加载是异步的，当它加载结束，JS 脚本会立即执行。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script <span class="token keyword">async</span> src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h5 id="defer-模式"><a href="#defer-模式" class="header-anchor">#</a> defer 模式</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script defer src<span class="token operator">=</span><span class="token string">&quot;index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>defer 模式下，JS 的加载是异步的，执行是被推迟的。等整个文档解析完成、DOMContentLoaded 事件即将被触发时，被标记了 defer 的 JS 文件才会开始依次执行。</p> <p>可以确认一个 JS 文件的执行时机并不一定非要是此时此刻，我们就可以通过对它使用 defer 和 async 来避免不必要的阻塞</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learning-area/业务相关/权限控制.html" class="prev">
        权限控制
      </a></span> <span class="next"><a href="/learning-area/性能优化/cdn.html">
        cdn
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/learning-area/assets/js/app.8c1e866d.js" defer></script><script src="/learning-area/assets/js/2.5f901e15.js" defer></script><script src="/learning-area/assets/js/97.286918aa.js" defer></script>
  </body>
</html>
