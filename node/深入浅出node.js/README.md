#### 单线程

单线程的最大好处：

不用像多线程编程那样处处在意状态的同步问题，这里没有死锁的存在，也没有线程上下文交换所带来的性能上的开销。

单线程的缺点：

- 无法利用多核CPU。
- 错误会引起整个应用退出，应用的健壮性值得考验。
- 大量计算占用CPU导致无法继续调用异步I/O。

`Web Workers`能够创建工作线程来进行计算，以解决JavaScript大计算阻塞UI渲染的问题。
工作线程为了不阻塞主线程，通过消息传递的方式来传递运行结果，这也使得工作线程不能访问到主线程中的UI。

Node采用了与Web Workers相同的思路来解决单线程中大计算量的问题：`child_process`。

在Node中引入模块，需要经历如下3个步骤。

1. 路径分析
2. 文件定位
3. 编译执行

在Node中，模块分为两类：

一类是Node提供的模块，称为核心模块；
另一类是用户编写的模块，称为文件模块。

> 在Node源代码的编译过程中，编译进了二进制执行文件。在Node进程启动时，部分核心模块就被直接加载进内存中，所以这部分核心模块引入时，文件定位和编译执行这两个步骤可以省略掉，并且在路径分析中优先判断，所以它的加载速度是最快的。
> 文件模块则是在运行时动态加载，需要完整的路径分析、文件定位、编译执行过程，速度比核心模块慢。

我们将那些由纯C/C++编写的部分统一称为内建模块，因为它们通常不被用户直接调用。Node的buffer、crypto、evals、fs、os等模块都是部分通过C/C++编写的。

### 包与NPM

包和NPM是将模块联系起来的一种机制

#### CommmonJS

CommmonJS包规范：

- 包结构（用于组织包中的各种文件）
- 包描述文件（用于描述包的相关信息，以供外部读取分析）

> 包实际上是一个存档文件，即一个目录直接打包为`.zip`或`tar.gz`格式的文件，安装后解压还原为目录

##### 包结构

- package.json：包描述文件。
- bin：用于存放可执行二进制文件的目录。
- lib：用于存放JavaScript代码的目录。
- doc：用于存放文档的目录。
- test：用于存放单元测试用例的代码。

##### 包描述文件与NPM

###### package.json

包描述文件用于表达非代码相关的信息，它是一个JSON格式的文件——package.json，位于包的根目录下，是包的重要组成部分。

`NPM`的所有行为都与包描述文件的字段息息相关。

- **name。包名**。规范定义它需要由小写的字母和数字组成，可以包含.、_和-，但不允许出现空格。包名必须是唯一的，以免对外公布时产生重名冲突的误解。除此之外，NPM还建议不要在包名中附带上node或js来重复标识它是JavaScript或Node模块。
- **description。包简介**。
- **version。版本号**。
- **keywords。关键词数组**，NPM中主要用来做分类搜索。一个好的关键词数组有利于用户快速找到你编写的包。
- maintainers。包维护者列表。每个维护者由name、email和web这3个属性组成。NPM通过该属性进行权限认证。
- contributors。贡献者列表。列表中的第一个贡献应当是包的作者本人。它的格式与维护者列表相同。
- bugs。一个可以反馈bug的网页地址或邮件地址。
- licenses。当前包所使用的许可证列表，表示这个包可以在哪些许可证下使用。
- **repositories。托管源代码的位置列表**，表明可以通过哪些方式和地址访问包的源代码。
- **dependencies。使用当前包所需要依赖的包列表**。这个属性十分重要，NPM会通过这个属性帮助
- engine。支持的JavaScript引擎列表，有效的引擎取值包括ejs、flusspferd、gpsee、jsc、spidermonkey、narwhal、node和v8。
- builtin。标志当前包是否是内建在底层系统的标准组件。
- directories。包目录说明。
- implements。实现规范的列表。标志当前包实现了CommonJS的哪些规范。
- **scripts。脚本说明对象**。它主要被包管理器用来安装、编译、测试和卸载包。
- **author。包作者**。
- bin。一些包作者希望包可以作为命令行工具使用。配置好bin字段后，通过npm install package_name -g命令可以将脚本添加到执行路径中，之后可以在命令行中直接执行。前面的node-gyp即是这样安装的。通过-g命令安装的模块包称为全局模式。

- main。模块引入方法require()在引入包时，会优先检查这个字段，并将其作为包中其余模块的入口。如果不存在这个字段，require()方法会查找包目录下的index.js、index.node、index.json文件作为默认入口。
- **devDependencies。一些模块只在开发时需要依赖**。配置这个属性，可以提示包的后续开发者安装依赖包。

#### NPM

**CommmonJS包规范是理论，NPM是其中的一种实践。**
对于Node而言，NPM帮助完成了第三方模块的发布、安装和依赖等，借助NPM，Node与第三方模块之间形成了很好的一个生态系统。

#### 包发布流程

- 编写模块
- 初始化包描述文件（npm init 生成package.json）